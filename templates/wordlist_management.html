{% extends "base.html" %}

{% block title %}Wordlist Management - Email Guardian{% endblock %}

{% block extra_head %}
<style>
    .keyword-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
    }
    
    .keyword-card:hover {
        border-color: #007bff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .category-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .category-business { background: #d1ecf1; color: #0c5460; }
    .category-personal { background: #fff3cd; color: #856404; }
    .category-suspicious { background: #f8d7da; color: #721c24; }
    
    .type-badge {
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .type-risk { background: #d4edda; color: #155724; }
    .type-exclusion { background: #f8d7da; color: #721c24; }
    
    .applies-to-badge {
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 0.7rem;
        background: #e9ecef;
        color: #495057;
    }
    
    .risk-score {
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8rem;
    }
    
    .risk-score-1 { background: #d4edda; color: #155724; }
    .risk-score-2 { background: #fff3cd; color: #856404; }
    .risk-score-3 { background: #ffeaa7; color: #856404; }
    .risk-score-4 { background: #fab1a0; color: #721c24; }
    .risk-score-5 { background: #f8d7da; color: #721c24; }
    
    .section-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .add-keyword-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 2px dashed #dee2e6;
    }
    
    .stats-card {
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }
    
    .stats-risk { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .stats-exclusion { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .stats-total { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
</style>
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{{ url_for('admin') }}">Admin</a></li>
<li class="breadcrumb-item active">Wordlist Management</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="section-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-2">
                    <i class="fas fa-list-alt me-3"></i>Wordlist Management
                </h1>
                <p class="mb-0">Manage risk keywords and exclusion keywords for email analysis</p>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <button class="btn btn-light btn-lg" onclick="showAddKeywordModal()">
                        <i class="fas fa-plus me-2"></i>Add Keyword
                    </button>
                    <button class="btn btn-primary btn-lg" onclick="showBulkAddModal()">
                        <i class="fas fa-upload me-2"></i>Bulk Add
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Overview -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card stats-total">
                <h3>{{ (risk_keywords|length) + (exclusion_keywords|length) }}</h3>
                <p class="mb-0">Total Keywords</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card stats-risk">
                <h3>{{ risk_keywords|length }}</h3>
                <p class="mb-0">Risk Keywords</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card stats-exclusion">
                <h3>{{ exclusion_keywords|length }}</h3>
                <p class="mb-0">Exclusion Keywords</p>
            </div>
        </div>
    </div>

    <!-- Main Content Tabs -->
    <ul class="nav nav-tabs" id="wordlistTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="risk-tab" data-bs-toggle="tab" data-bs-target="#risk-keywords" type="button" role="tab">
                <i class="fas fa-exclamation-triangle me-2"></i>Risk Keywords ({{ risk_keywords|length }})
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="exclusion-tab" data-bs-toggle="tab" data-bs-target="#exclusion-keywords" type="button" role="tab">
                <i class="fas fa-ban me-2"></i>Exclusion Keywords ({{ exclusion_keywords|length }})
            </button>
        </li>
    </ul>

    <div class="tab-content" id="wordlistTabContent">
        <!-- Risk Keywords Tab -->
        <div class="tab-pane fade show active" id="risk-keywords" role="tabpanel">
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-brain text-primary me-2"></i>Risk Keywords</h4>
                    <small class="text-muted">Keywords that increase email risk scores</small>
                </div>
                
                {% if risk_by_category %}
                    {% for category, keywords in risk_by_category.items() %}
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <span class="category-badge category-{{ category.lower() }}">{{ category }}</span>
                                <span class="ms-2">{{ keywords|length }} keywords</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for keyword in keywords %}
                                <div class="col-md-6 col-lg-4 mb-2">
                                    <div class="keyword-card p-3">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <strong>{{ keyword.keyword }}</strong>
                                                <div class="mt-1">
                                                    <span class="type-badge type-{{ keyword.keyword_type }}">{{ keyword.keyword_type.title() }}</span>
                                                    <span class="applies-to-badge ms-1">{{ keyword.applies_to }}</span>
                                                    <span class="risk-score risk-score-{{ keyword.risk_score }} ms-1">Risk: {{ keyword.risk_score }}</span>
                                                </div>
                                            </div>
                                            <div class="dropdown">
                                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" onclick="editKeyword({{ keyword.id }})">
                                                        <i class="fas fa-edit me-2"></i>Edit
                                                    </a></li>
                                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteKeyword({{ keyword.id }})">
                                                        <i class="fas fa-trash me-2"></i>Delete
                                                    </a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No risk keywords configured yet. Click "Add Keyword" to get started.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Exclusion Keywords Tab -->
        <div class="tab-pane fade" id="exclusion-keywords" role="tabpanel">
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="fas fa-shield-alt text-warning me-2"></i>Exclusion Keywords</h4>
                    <small class="text-muted">Keywords that exclude emails from analysis</small>
                </div>
                
                {% if exclusion_by_applies_to %}
                    {% for applies_to, keywords in exclusion_by_applies_to.items() %}
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <span class="applies-to-badge">Applies to: {{ applies_to.title() }}</span>
                                <span class="ms-2">{{ keywords|length }} keywords</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                {% for keyword in keywords %}
                                <div class="col-md-6 col-lg-4 mb-2">
                                    <div class="keyword-card p-3">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <strong>{{ keyword.keyword }}</strong>
                                                <div class="mt-1">
                                                    <span class="type-badge type-{{ keyword.keyword_type }}">{{ keyword.keyword_type.title() }}</span>
                                                    <span class="category-badge category-{{ keyword.category.lower() }} ms-1">{{ keyword.category }}</span>
                                                </div>
                                            </div>
                                            <div class="dropdown">
                                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" onclick="editKeyword({{ keyword.id }})">
                                                        <i class="fas fa-edit me-2"></i>Edit
                                                    </a></li>
                                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteKeyword({{ keyword.id }})">
                                                        <i class="fas fa-trash me-2"></i>Delete
                                                    </a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No exclusion keywords configured yet. Click "Add Keyword" to get started.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Keyword Modal -->
<div class="modal fade" id="keywordModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="keywordModalTitle">
                    <i class="fas fa-plus-circle me-2"></i>Add New Keyword
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="keywordForm">
                    <input type="hidden" id="keywordId">
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="keywordText" class="form-label">Keyword (single words or phrases) *</label>
                            <input type="text" class="form-control" id="keywordText" placeholder="Enter keyword or phrase..." required>
                            <div class="form-text">Examples: "confidential", "password", "personal information", "data breach"</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="keywordType" class="form-label">Type *</label>
                            <select class="form-select" id="keywordType" onchange="toggleTypeOptions()">
                                <option value="risk">Risk Keyword</option>
                                <option value="exclusion">Exclusion Keyword</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="keywordCategory" class="form-label">Category</label>
                            <select class="form-select" id="keywordCategory">
                                <option value="Business">Business</option>
                                <option value="Personal">Personal</option>
                                <option value="Suspicious">Suspicious</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="appliesTo" class="form-label">Applies To</label>
                            <select class="form-select" id="appliesTo">
                                <option value="both">Subject & Attachments</option>
                                <option value="subject">Subject Only</option>
                                <option value="attachment">Attachments Only</option>
                            </select>
                        </div>
                    </div>

                    <div class="row" id="riskScoreRow">
                        <div class="col-md-6 mb-3">
                            <label for="riskScore" class="form-label">Risk Score (1-10)</label>
                            <input type="number" class="form-control" id="riskScore" min="1" max="10" value="1">
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-1"></i>Keyword Types</h6>
                        <ul class="mb-0 small">
                            <li><strong>Risk Keywords:</strong> Increase the risk score when found in emails</li>
                            <li><strong>Exclusion Keywords:</strong> Automatically exclude emails from analysis</li>
                            <li><strong>Multi-word phrases:</strong> Supported (e.g., "personal information", "data breach")</li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveKeyword()">
                    <i class="fas fa-save me-1"></i>Save Keyword
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Add Keywords Modal -->
<div class="modal fade" id="bulkKeywordModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-upload me-2"></i>Bulk Add Keywords
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="bulkKeywordForm">
                    <!-- Default Settings -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-cog me-2"></i>Default Settings for All Keywords</h6>
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="bulkKeywordType" class="form-label">Type</label>
                                    <select class="form-select" id="bulkKeywordType">
                                        <option value="risk">Risk Keyword</option>
                                        <option value="exclusion">Exclusion Keyword</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="bulkKeywordCategory" class="form-label">Category</label>
                                    <select class="form-select" id="bulkKeywordCategory">
                                        <option value="Business">Business</option>
                                        <option value="Personal">Personal</option>
                                        <option value="Suspicious">Suspicious</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="bulkAppliesTo" class="form-label">Applies To</label>
                                    <select class="form-select" id="bulkAppliesTo">
                                        <option value="both">Subject & Attachments</option>
                                        <option value="subject">Subject Only</option>
                                        <option value="attachment">Attachments Only</option>
                                    </select>
                                </div>
                                <div class="col-md-3" id="bulkRiskScoreRow">
                                    <label for="bulkRiskScore" class="form-label">Risk Score (1-10)</label>
                                    <input type="number" class="form-control" id="bulkRiskScore" min="1" max="10" value="1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Keywords Input -->
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-list me-2"></i>Keywords to Add</h6>
                            <div class="mb-3">
                                <label for="bulkKeywordsText" class="form-label">Enter keywords (one per line)</label>
                                <textarea class="form-control" id="bulkKeywordsText" rows="10" 
                                          placeholder="Enter keywords, one per line. Examples:
confidential
password
personal information
data breach
secret documents
financial records"></textarea>
                                <div class="form-text">
                                    <strong>Tips:</strong>
                                    • Enter one keyword or phrase per line
                                    • Multi-word phrases are supported (e.g., "personal information")
                                    • Empty lines will be ignored
                                    • Duplicate keywords will be skipped automatically
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="row" id="previewSection" style="display: none;">
                        <div class="col-12">
                            <h6 class="text-success"><i class="fas fa-eye me-2"></i>Preview Keywords</h6>
                            <div class="alert alert-light border" id="previewContent">
                                <!-- Preview will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-1"></i>Bulk Add Information</h6>
                        <ul class="mb-0 small">
                            <li>All keywords will use the default settings above unless individually configured</li>
                            <li>Both single words and multi-word phrases are supported</li>
                            <li>Existing keywords will be automatically skipped</li>
                            <li>You'll receive a detailed report of what was added, skipped, or had errors</li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" onclick="previewBulkKeywords()">
                    <i class="fas fa-eye me-1"></i>Preview
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveBulkKeywords()">
                    <i class="fas fa-upload me-1"></i>Add All Keywords
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Show add keyword modal
function showAddKeywordModal() {
    document.getElementById('keywordModalTitle').innerHTML = '<i class="fas fa-plus-circle me-2"></i>Add New Keyword';
    document.getElementById('keywordForm').reset();
    document.getElementById('keywordId').value = '';
    new bootstrap.Modal(document.getElementById('keywordModal')).show();
}

// Toggle options based on keyword type
function toggleTypeOptions() {
    const keywordType = document.getElementById('keywordType').value;
    const riskScoreRow = document.getElementById('riskScoreRow');
    
    if (keywordType === 'risk') {
        riskScoreRow.style.display = 'block';
    } else {
        riskScoreRow.style.display = 'none';
    }
}

// Save keyword
function saveKeyword() {
    const keywordId = document.getElementById('keywordId').value;
    const isEdit = keywordId !== '';
    
    const data = {
        keyword: document.getElementById('keywordText').value.trim(),
        keyword_type: document.getElementById('keywordType').value,
        category: document.getElementById('keywordCategory').value,
        applies_to: document.getElementById('appliesTo').value,
        risk_score: parseInt(document.getElementById('riskScore').value) || 1
    };
    
    if (!data.keyword) {
        alert('Please enter a keyword');
        return;
    }
    
    const url = isEdit ? `/api/wordlist/${keywordId}` : '/api/wordlist/add';
    const method = isEdit ? 'PUT' : 'POST';
    
    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            alert(data.message);
            bootstrap.Modal.getInstance(document.getElementById('keywordModal')).hide();
            window.location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving keyword');
    });
}

// Edit keyword
function editKeyword(keywordId) {
    // This would need to fetch the keyword data and populate the form
    alert('Edit functionality will be enhanced in the next update!');
}

// Delete keyword
function deleteKeyword(keywordId) {
    if (confirm('Are you sure you want to delete this keyword?')) {
        fetch(`/api/wordlist/${keywordId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Error: ' + data.error);
            } else {
                alert(data.message);
                window.location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting keyword');
        });
    }
}

// Show bulk add keywords modal
function showBulkAddModal() {
    document.getElementById('bulkKeywordForm').reset();
    document.getElementById('previewSection').style.display = 'none';
    toggleBulkTypeOptions();
    new bootstrap.Modal(document.getElementById('bulkKeywordModal')).show();
}

// Toggle bulk options based on keyword type
function toggleBulkTypeOptions() {
    const keywordType = document.getElementById('bulkKeywordType').value;
    const riskScoreRow = document.getElementById('bulkRiskScoreRow');
    
    if (keywordType === 'risk') {
        riskScoreRow.style.display = 'block';
    } else {
        riskScoreRow.style.display = 'none';
    }
}

// Preview bulk keywords
function previewBulkKeywords() {
    const keywordsText = document.getElementById('bulkKeywordsText').value.trim();
    const previewSection = document.getElementById('previewSection');
    const previewContent = document.getElementById('previewContent');
    
    if (!keywordsText) {
        alert('Please enter some keywords first');
        return;
    }
    
    // Parse keywords
    const keywords = keywordsText.split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0);
    
    if (keywords.length === 0) {
        alert('No valid keywords found');
        return;
    }
    
    // Generate preview
    const keywordType = document.getElementById('bulkKeywordType').value;
    const category = document.getElementById('bulkKeywordCategory').value;
    const appliesTo = document.getElementById('bulkAppliesTo').value;
    const riskScore = document.getElementById('bulkRiskScore').value;
    
    let previewHtml = `
        <div class="mb-3">
            <strong>Preview:</strong> ${keywords.length} keywords will be added with these settings:
        </div>
        <div class="row mb-3">
            <div class="col-md-3">
                <strong>Type:</strong> <span class="badge bg-${keywordType === 'risk' ? 'primary' : 'warning'}">${keywordType.charAt(0).toUpperCase() + keywordType.slice(1)}</span>
            </div>
            <div class="col-md-3">
                <strong>Category:</strong> <span class="badge bg-secondary">${category}</span>
            </div>
            <div class="col-md-3">
                <strong>Applies To:</strong> <span class="badge bg-info">${appliesTo}</span>
            </div>
            ${keywordType === 'risk' ? `<div class="col-md-3"><strong>Risk Score:</strong> <span class="badge bg-danger">${riskScore}</span></div>` : ''}
        </div>
        <div class="keywords-preview">
            <strong>Keywords to add:</strong><br>
    `;
    
    keywords.forEach((keyword, index) => {
        previewHtml += `<span class="badge bg-light text-dark me-1 mb-1">${keyword}</span>`;
    });
    
    previewHtml += '</div>';
    
    previewContent.innerHTML = previewHtml;
    previewSection.style.display = 'block';
}

// Save bulk keywords
function saveBulkKeywords() {
    const keywordsText = document.getElementById('bulkKeywordsText').value.trim();
    
    if (!keywordsText) {
        alert('Please enter some keywords first');
        return;
    }
    
    // Parse keywords
    const keywords = keywordsText.split('\n')
        .map(line => line.trim())
        .filter(line => line.length > 0);
    
    if (keywords.length === 0) {
        alert('No valid keywords found');
        return;
    }
    
    const data = {
        keywords: keywords,
        default_keyword_type: document.getElementById('bulkKeywordType').value,
        default_category: document.getElementById('bulkKeywordCategory').value,
        default_applies_to: document.getElementById('bulkAppliesTo').value,
        default_risk_score: parseInt(document.getElementById('bulkRiskScore').value) || 1
    };
    
    // Show loading state
    const saveButton = document.querySelector('#bulkKeywordModal .btn-primary');
    const originalText = saveButton.innerHTML;
    saveButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Adding Keywords...';
    saveButton.disabled = true;
    
    fetch('/api/wordlist/bulk-add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            // Show detailed results
            let message = data.message + '\n\n';
            
            if (data.added_count > 0) {
                message += `✓ Successfully added ${data.added_count} keywords\n`;
            }
            
            if (data.skipped_count > 0) {
                message += `⚠ Skipped ${data.skipped_count} existing keywords\n`;
                if (data.skipped_keywords.length > 0) {
                    message += 'Skipped keywords: ' + data.skipped_keywords.map(k => k.keyword).join(', ') + '\n';
                }
            }
            
            if (data.error_count > 0) {
                message += `❌ ${data.error_count} keywords had errors\n`;
                if (data.errors.length > 0) {
                    message += 'Errors: ' + data.errors.map(e => `${e.keyword}: ${e.error}`).join(', ') + '\n';
                }
            }
            
            alert(message);
            bootstrap.Modal.getInstance(document.getElementById('bulkKeywordModal')).hide();
            window.location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error adding bulk keywords: ' + error);
    })
    .finally(() => {
        // Restore button state
        saveButton.innerHTML = originalText;
        saveButton.disabled = false;
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleTypeOptions();
    
    // Add event listener for bulk keyword type changes
    document.getElementById('bulkKeywordType').addEventListener('change', toggleBulkTypeOptions);
});
</script>
{% endblock %}